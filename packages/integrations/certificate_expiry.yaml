certificate_expiry_package:
  sensor:
    - platform: template
      sensors:
        s_cert_exiry_d:
          friendly_name: "Duck DNS SSL Cert Expiry"
          value_template: >
            {{ ((as_timestamp(states('sensor.cert_expiry_timestamp_ha_star114_duckdns_org')) - as_timestamp(states.sensor.date.last_updated)) / 86400) | int }}
          icon_template: >-
            {% if states('sensor.cert_expiry_timestamp_ha_star114_duckdns_org') | int > 0 %}
              mdi:certificate
            {% else %}
              mdi:certificate-outline
            {% endif %}
          unit_of_measurement: "days"

  automation:
    - id: "notify_the_remaining_days_of_certificate_expiry"
      alias: "Notify the remaining days of certificate expiry"
      trigger:
        - platform: numeric_state
          entity_id: sensor.s_cert_exiry_d
          below: 7
      action:
        - service: notify.notify_telegram
          data:
            title: "⚠️ 인증서 만료 알림 ⚠️"
            message: "Nginx Proxy Manager 웹을 방문하여 인증서를 갱신하세요."
    - id: "warning_certificate_expiry"
      alias: "Warning certificate expiry"
      trigger:
        - platform: numeric_state
          entity_id: sensor.s_cert_exiry_d
          below: 2
      action:
        - service: notify.notify_telegram
          data:
            title: "⛔️ 인증서 만료 경고 ⛔️"
            message: "Nginx Proxy Manager 웹을 방문하여 인증서를 갱신하세요."
