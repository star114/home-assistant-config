# telegram

# telegram_bot: https://www.home-assistant.io/integrations/telegram_bot
# - webhooks: https://www.home-assistant.io/integrations/telegram_webhooks
# - polling
# webhooks is preferred but personal ha instance should be exposed to public network

telegram_package:
  telegram_bot:
    - platform: webhooks
      api_key: !secret telegram_bot_api_key
      allowed_chat_ids:
        - !secret telegram_chat_id1

  # notifier
  notify:
    - platform: telegram
      name: notify_telegram
      chat_id: !secret telegram_chat_id1

  automation:
    - id: "start_telegram_commands"
      alias: "Start telegram commands"
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/start"
      action:
        - service: notify.notify_telegram
          data:
            message: "commands"
            data:
              keyboard:
                - "/broadcast"
                - "/reset_main_brush_left, /reset_side_brush_left"
                - "/reset_filter_left, /reset_sensor_dirty_left"

    - id: "telegram_command_to_reset_main_brush_left"
      alias: "Telegram command to reset main brush left"
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/reset_main_brush_left"
      action:
        - service: script.reset_main_brush_left
        - service: notify.notify_telegram
          data:
            message: "뽀봇 메인브러쉬 리셋 완료"
    - id: "telegram_command_to_reset_side_brush_left"
      alias: "Telegram command to reset side brush left"
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/reset_side_brush_left"
      action:
        - service: script.reset_side_brush_left
        - service: notify.notify_telegram
          data:
            message: "뽀봇 사이드브러쉬 리셋 완료"
    - id: "telegram_command_to_reset_filter_left"
      alias: "Telegram command to reset filter left"
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/reset_filter_left"
      action:
        - service: script.reset_filter_left
        - service: notify.notify_telegram
          data:
            message: "뽀봇 필터 리셋 완료"
    - id: "telegram_command_to_reset_sensor_dirty_left"
      alias: "Telegram command to reset sensor dirty left"
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/reset_sensor_dirty_left"
      action:
        - service: script.reset_sensor_dirty_left
        - service: notify.notify_telegram
          data:
            message: "뽀봇 센서 리셋 완료"
    - id: "telegram_command_to_broadcast"
      alias: "Telegram command to broadcast"
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/broadcast"
      action:
        - service: notify.galaxy_cloud_speak
          data:
            message: |
              {% for state in trigger.event.data["args"] %} {{ state }} {% endfor %}
